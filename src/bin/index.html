<html>
  <title id="title">Channel Example</title>
  <body> 
    <a>Check in the DevTools Console</a>
    <p id='ev-dt'>
      counter: <b id="counter"></b>, current time: <b id="datetime"></b></b>
    </p>

  </body>
  <script src='https://unpkg.com/phoenix@1.7.11/priv/static/phoenix.min.js'></script>
  <script src='https://unpkg.com/morphdom@2.6.1/dist/morphdom-umd.js'></script>
  <!-- <script type='module'> -->
  <script>
    // channel https://hexdocs.pm/phenox/js/

    const { Socket, Channel, Presence } = Phoenix;
    // import morphdom from 'https://unpkg.com/morphdom@2.6.1/dist/morphdom-esm.js';

    // https://www.npmjs.com/package/morphdom#morphdomfromnode-tonode-options--node
    console.dir(morphdom);

    function onDatetime ({ status, response: { datetime, counter } }) {
      // console.log(`status: ${status}, datetime, ${datetime}, counter: ${counter}`);

      document.getElementById('datetime').innerText = datetime;
      document.getElementById('counter').innerHTML = counter;
    };

    function dump({ status, response }) {
      console.log(`status: ${status}, response: ${response}`);
    }

    let userToken = 'userSocketToken';
    let debug = false;
    let socket = new Socket("", { debug, params: { userToken } });
    socket.connect();

    function joinChannel(channelName, channelToken) {
      console.dir(socket);
      let channel = socket.channel(channelName, { token: channelToken });

      channel.on('datetime', onDatetime); // ?
      channel.on('data', dump);

      console.log(`joinning channel ${channelName}`)
      channel
        .join()
        .receive('ok', (ev) => {
          console.log(`(${channelName} - joined`, ev)
        })
        .receive('error', ({ reason }) => {
          console.log(`${channelName} - failed to join`, reason);
        })
        .receive('timeout', () => {
          console.log(`${channelName} - joining timeouts`);
        });
      return channel;
    }

    function leaveSystem() {
      if (window.systemChannel !== null) window.systemChannel.leave();
      window.systemChannel = null;
    }


    window.systemChannel = joinChannel('system', 'hello-system');
    window.streamingChannel = joinChannel('streaming', 'hello-streaming');
  </script>
</html>

